# üì± –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ: –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ –∫–æ–Ω—Ç–∞–∫—Ç

## üéØ –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å

### ‚úÖ –ù–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤:
- **–í–º–µ—Å—Ç–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏** (–§–ò–û ‚Üí –¢–µ–ª–µ—Ñ–æ–Ω ‚Üí –î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è)
- **–¢–µ–ø–µ—Ä—å –ø—Ä–æ—Å—Ç–æ–π –≤—Ö–æ–¥** —á–µ—Ä–µ–∑ "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è –∫–æ–Ω—Ç–∞–∫—Ç–æ–º"

### üî¢ –ù–æ–≤—ã–µ –Ω–æ–º–µ—Ä–∞ –∫–∞—Ä—Ç:
- **–í–º–µ—Å—Ç–æ —Å–ª—É—á–∞–π–Ω—ã—Ö 5-–∑–Ω–∞—á–Ω—ã—Ö** (12345, 67890)
- **–¢–µ–ø–µ—Ä—å –ø–æ—Ä—è–¥–∫–æ–≤—ã–µ** (1, 2, 3, 4, 5...)

### üîÑ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:
- –í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–ª–∏–µ–Ω—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã
- Telegram ID –æ—Å—Ç–∞–µ—Ç—Å—è —Ä–∞–±–æ—á–∏–º –¥–ª—è –≤—Ö–æ–¥–∞
- –î–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–æ–≤ –Ω–µ —Ç–µ—Ä—è—é—Ç—Å—è

## üöÄ –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

### 1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –±–æ—Ç–∞
```bash
docker-compose down
```

### 2. –°–¥–µ–ª–∞–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –ë–î
```bash
docker exec rock_coffee_db pg_dump -U postgres rock_coffee_bot > backup_before_phone_auth.sql
```

### 3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é
```bash
npm run migrate-phone-auth
```
*–∏–ª–∏*
```bash
ts-node scripts/migrate-to-phone-auth.ts
```

### 4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∏—Å—Ç–µ–º—É
```bash
docker-compose up -d --build
```

## üìã –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –º–∏–≥—Ä–∞—Ü–∏–∏

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:
1. ‚úÖ –î–æ–±–∞–≤–ª—è—é—Ç—Å—è –∫–æ–ª–æ–Ω–∫–∏ `auth_method`, `profile_completed`, `first_name`
2. ‚úÖ –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–ª–∏–µ–Ω—Ç—ã –ø–æ–º–µ—á–∞—é—Ç—Å—è –∫–∞–∫ `auth_method = 'full_registration'`
3. ‚úÖ –í—Å–µ –∫–∞—Ä—Ç—ã –ø–µ—Ä–µ–Ω—É–º–µ—Ä–æ–≤—ã–≤–∞—é—Ç—Å—è: 1, 2, 3, 4, 5...
4. ‚úÖ –°–æ–∑–¥–∞—é—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–æ–∏—Å–∫–∞/—Å–æ–∑–¥–∞–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤ –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É
5. ‚úÖ –î–æ–±–∞–≤–ª—è—é—Ç—Å—è –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É

### –ö–æ–¥:
1. ‚úÖ –ó–∞–º–µ–Ω–µ–Ω `ClientHandler` –Ω–∞ –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π —á–µ—Ä–µ–∑ –∫–æ–Ω—Ç–∞–∫—Ç
2. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `ClientService` —Å –º–µ—Ç–æ–¥–∞–º–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç–µ–ª–µ—Ñ–æ–Ω–∞–º–∏
3. ‚úÖ –ù–æ–≤—ã–π `middleware` –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
4. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω –≥–ª–∞–≤–Ω—ã–π `index.ts` –¥–ª—è –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã

## üîç –ö–∞–∫ —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

### –î–ª—è –Ω–æ–≤—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤:
1. –ö–ª–∏–µ–Ω—Ç –Ω–∞–∂–∏–º–∞–µ—Ç `/start`
2. –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ—Å–∏—Ç "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è –∫–æ–Ω—Ç–∞–∫—Ç–æ–º"
3. –ü–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –∏—â–µ—Ç –∫–ª–∏–µ–Ω—Ç–∞ –≤ –ë–î
4. –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω - —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤–æ–≥–æ —Å –ø–æ—Ä—è–¥–∫–æ–≤—ã–º –Ω–æ–º–µ—Ä–æ–º –∫–∞—Ä—Ç—ã
5. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–∞—Ä—Ç—É –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏

### –î–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤:
1. –ï—Å–ª–∏ –µ—Å—Ç—å `telegram_id` - —Å—Ä–∞–∑—É –∞–≤—Ç–æ—Ä–∏–∑—É–µ—Ç
2. –ï—Å–ª–∏ –Ω–µ—Ç `telegram_id` –Ω–æ –µ—Å—Ç—å —Ç–µ–ª–µ—Ñ–æ–Ω - –º–æ–∂–µ—Ç –≤–æ–π—Ç–∏ –ø–æ –∫–æ–Ω—Ç–∞–∫—Ç—É
3. –í—Å–µ –¥–∞–Ω–Ω—ã–µ –∏ –±–∞–ª–ª—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è

## üí≥ –ù–æ–≤—ã–µ –Ω–æ–º–µ—Ä–∞ –∫–∞—Ä—Ç

### –ë—ã–ª–æ:
- –°–ª—É—á–∞–π–Ω—ã–µ 5-–∑–Ω–∞—á–Ω—ã–µ: 12345, 67890, 54321...
- –°–ª–æ–∂–Ω–æ –∑–∞–ø–æ–º–Ω–∏—Ç—å
- –ú–æ–≥–ª–∏ –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å—Å—è

### –°—Ç–∞–ª–æ:
- –ü–æ—Ä—è–¥–∫–æ–≤—ã–µ –ø—Ä–æ—Å—Ç—ã–µ: 1, 2, 3, 4, 5...
- –õ–µ–≥–∫–æ –∑–∞–ø–æ–º–Ω–∏—Ç—å –∏ —Å–æ–æ–±—â–∏—Ç—å –±–∞—Ä–∏—Å—Ç–∞
- –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –¥—É–±–ª–∏—Ä—É—é—Ç—Å—è

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

### ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ:
- –í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–ª–∏–µ–Ω—Ç—ã –∏ –∏—Ö –¥–∞–Ω–Ω—ã–µ
- –ë–∞–ª–∞–Ω—Å –±–∞–ª–ª–æ–≤
- –ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- –ó–∞–º–µ—Ç–∫–∏ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

### ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ:
- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞
- –ë—ã—Å—Ç—Ä—ã–π –≤—Ö–æ–¥ —á–µ—Ä–µ–∑ –∫–æ–Ω—Ç–∞–∫—Ç
- –ü—Ä–æ—Å—Ç—ã–µ –Ω–æ–º–µ—Ä–∞ –∫–∞—Ä—Ç
- –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è

### ‚úÖ –£–ª—É—á—à–µ–Ω–æ:
- –ë–æ–ª–µ–µ –ø—Ä–æ—Å—Ç–æ–π UX –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤
- –ú–µ–Ω—å—à–µ —à–∞–≥–æ–≤ –¥–ª—è –≤—Ö–æ–¥–∞ –≤ —Å–∏—Å—Ç–µ–º—É
- –£–¥–æ–±–Ω–µ–µ –¥–ª—è –±–∞—Ä–∏—Å—Ç (–ø—Ä–æ—Å—Ç—ã–µ –Ω–æ–º–µ—Ä–∞ –∫–∞—Ä—Ç)

## üêõ –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞: –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î –∏ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞:
```bash
docker-compose ps
docker-compose logs postgres
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ö–ª–∏–µ–Ω—Ç—ã –Ω–µ –º–æ–≥—É—Ç –≤–æ–π—Ç–∏
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —É –Ω–∏—Ö –µ—Å—Ç—å `telegram_id` –∏–ª–∏ –æ–Ω–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ç–æ—Ç –∂–µ —Ç–µ–ª–µ—Ñ–æ–Ω:
```sql
SELECT telegram_id, phone, auth_method FROM clients WHERE id = [CLIENT_ID];
```

### –ü—Ä–æ–±–ª–µ–º–∞: –î—É–±–ª–∏—Ä—É—é—Ç—Å—è –Ω–æ–º–µ—Ä–∞ –∫–∞—Ä—Ç
**–†–µ—à–µ–Ω–∏–µ:** –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é –Ω—É–º–µ—Ä–∞—Ü–∏–∏:
```sql
SELECT * FROM generate_card_number();
```

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `docker-compose logs -f bot`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ë–î: –ø–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ `SELECT * FROM clients LIMIT 5;`
3. –ü—Ä–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–∫–∞—Ö –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∏–∑ backup: `psql -U postgres rock_coffee_bot < backup_before_phone_auth.sql`

---

**üéâ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ! –°–∏—Å—Ç–µ–º–∞ —Ç–µ–ø–µ—Ä—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø—Ä–æ—Å—Ç–æ–π –≤—Ö–æ–¥ —á–µ—Ä–µ–∑ –∫–æ–Ω—Ç–∞–∫—Ç –∏ —É–¥–æ–±–Ω—ã–µ –ø–æ—Ä—è–¥–∫–æ–≤—ã–µ –Ω–æ–º–µ—Ä–∞ –∫–∞—Ä—Ç.**